<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prague Quest: The King's Path</title>
    <style>
        :root { --royal-gold: #d4af37; --royal-brown: #8b4513; --parchment: #f4e4bc; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Comic Sans MS', sans-serif; background: var(--parchment); overflow: hidden; }
        #map-canvas { width: 100%; height: 100vh; border: none; }
        #king-trigger { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--royal-brown); color: white; border: 3px solid var(--royal-gold);
            padding: 18px 35px; border-radius: 50px; font-size: 1.3rem; font-weight: bold;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5); cursor: pointer; z-index: 999;
        }
        #chat-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        #chat-window { width: 90%; max-width: 450px; height: 75vh; background: white; border: 5px solid var(--royal-gold); border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        #chat-header { background: var(--royal-brown); color: white; padding: 15px; text-align: center; position: relative; font-size: 1.2rem; }
        #close-chat { position: absolute; right: 15px; top: 10px; cursor: pointer; font-size: 2rem; }
        #chat-history { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; background: #fffdf9; }
        .msg { padding: 12px 16px; border-radius: 15px; line-height: 1.4; max-width: 85%; }
        .k-msg { background: #f1f1f1; align-self: flex-start; border-left: 5px solid var(--royal-gold); color: #333; }
        .u-msg { background: #007bff; color: white; align-self: flex-end; }
        #input-area { padding: 15px; background: white; border-top: 1px solid #ddd; display: flex; gap: 10px; }
        input { flex-grow: 1; padding: 12px; border: 2px solid #ccc; border-radius: 10px; }
        button#send-btn { background: var(--royal-brown); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        .diploma { border: 6px double var(--royal-gold); padding: 15px; text-align: center; background: #fffecf; }
    </style>
</head>
<body>

    <iframe id="map-canvas" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2559.847526978135!2d14.4194!3d50.0875!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x470b94eb0905e39d%3A0x6b499153c39396e9!2sOld%20Town%20Square!5e0!3m2!1sen!2scz!4v1700000000000"></iframe>

    <button id="king-trigger" onclick="openChat()">ðŸ‘‘ TALK TO THE KING</button>

    <div id="chat-overlay">
        <div id="chat-window">
            <div id="chat-header"><strong>King Charles IV</strong><span id="close-chat" onclick="closeChat()">Ã—</span></div>
            <div id="chat-history" id="history-box">
                <div class="msg k-msg">Greetings, young traveler! I am the King. I built the bridge, the university, and the tower... but I see you have no horse! <br><br>Tell me, is the bell at the Stone Bell House made of metal or stone?</div>
            </div>
            <div id="input-area">
                <input type="text" id="user-input" placeholder="Answer the King..." onkeypress="if(event.key==='Enter')handleSend()">
                <button id="send-btn" onclick="handleSend()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let step = 1;
        const cheeky = ["That is a strange thing to say! Focus on the quest!", "In my day, we didn't talk like that to Kings!", "Haha! Very funny. Now, back to the riddles!", "I am a King, not a jester! Answer my question!", "Enough silliness! The treasure won't find itself!"];

        function openChat() { document.getElementById('chat-overlay').style.display = 'flex'; }
        function closeChat() { document.getElementById('chat-overlay').style.display = 'none'; }

        function handleSend() {
            const input = document.getElementById('user-input');
            const history = document.getElementById('chat-history');
            const val = input.value.toLowerCase().trim();
            if (!val) return;

            history.innerHTML += `<div class="msg u-msg">${input.value}</div>`;
            input.value = "";

            setTimeout(() => {
                let reply = "";
                // Logic for Riddles
                if (step === 1 && (val.includes("stone") || val.includes("rock") || val.includes("kamen"))) {
                    reply = "Huzzah! It is stone. I lived in that house when I was a boy! Now, find the man named 'Vanity' on the Clock. What is he holding?";
                    step = 2;
                } else if (step === 2 && (val.includes("mirror") || val.includes("zrcadlo"))) {
                    reply = "A mirror! He is too proud. Now, find the Kingfisher bird at the Bridge Tower. What is he sitting inside?";
                    step = 3;
                } else if (step === 3 && (val.includes("wreath") || val.includes("circle") || val.includes("venec"))) {
                    reply = `<div class="diploma"><h3>ðŸ“œ ROYAL DIPLOMA ðŸ“œ</h3><p>You have finished! My magic number is:</p><h2>1357 9 7 5 3 1</h2></div>`;
                    step = 4;
                } 
                // Logic for "Cheeky" or Irrelevant stuff
                else if (val.includes("sex") || val.includes("butt") || val.includes("poop") || val.includes("stupid")) {
                    reply = "By my crown! Such language is not for a Royal Quest. Back to the hunt, scholar!";
                } else {
                    reply = cheeky[Math.floor(Math.random() * cheeky.length)];
                }

                history.innerHTML += `<div class="msg k-msg">${reply}</div>`;
                history.scrollTop = history.scrollHeight;
            }, 600);
        }
    </script>
</body>
</html>

