<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advisor to the King: Senior Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=UnifrakturMaguntia&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Crimson Pro', serif; background-color: #1a1a1a; color: #e5e5e5; }
        .parchment { background-color: #2c241e; border: 2px solid #8d6e63; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .gothic { font-family: 'UnifrakturMaguntia', cursive; color: #d4a373; }
        .chat-box { height: 60vh; overflow-y: auto; scrollbar-width: thin; scrollbar-color: #8d6e63 #2c241e; }
        input { background: #3d332d !important; color: #fef3c7 !important; border: 1px solid #8d6e63 !important; }
        .bot-msg { background: #3d332d; border-left: 3px solid #d4a373; }
        .user-msg { background: #4a3f35; border-right: 3px solid #8d6e63; }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <div class="max-w-2xl w-full parchment rounded-lg overflow-hidden flex flex-col">
        <header class="p-6 border-b border-[#8d6e63] text-center bg-[#231d19]">
            <h1 class="text-3xl gothic">Imperial Advisor</h1>
            <p class="text-xs uppercase tracking-widest text-[#d4a373] mt-1">Court of His Majesty Charles IV</p>
        </header>

        <div id="chat-container" class="chat-box p-6 space-y-4">
            <div class="bot-msg p-4 rounded-lg shadow-sm">
                <p class="italic text-[#d4a373] font-bold mb-1 italic">The Royal Advisor whispers:</p>
                <p>"Greeting, seeker of truth. You stand in the Golden City of the Holy Roman Empire. I am here to provide the wisdom of the ages, though I shall not hand you the victory you must earn. What knowledge do you seek of our Emperor's works?"</p>
            </div>
        </div>

        <div class="p-4 border-t border-[#8d6e63] bg-[#231d19]">
            <div class="flex gap-2">
                <input type="text" id="user-input" class="flex-1 p-3 rounded shadow-inner outline-none" placeholder="Ask the Advisor..." onkeypress="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()" class="bg-[#8d6e63] text-white px-6 py-2 rounded font-bold hover:bg-[#a68275] transition-colors">Speak</button>
            </div>
            <p id="error-display" class="text-[10px] text-red-400 mt-2 hidden text-center italic">The spirits are silent. Please try again.</p>
        </div>
    </div>

    <script>
        const apiKey = ""; // Provided by environment

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const container = document.getElementById('chat-container');
            const errorDisplay = document.getElementById('error-display');
            const text = input.value.trim();
            
            if (!text) return;
            errorDisplay.classList.add('hidden');

            // Add user message to UI
            const userDiv = document.createElement('div');
            userDiv.className = 'user-msg p-4 rounded-lg shadow-sm text-right ml-12';
            userDiv.innerHTML = `<p>${text}</p>`;
            container.appendChild(userDiv);
            input.value = '';
            container.scrollTop = container.scrollHeight;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: text }] }],
                        systemInstruction: { parts: [{ text: "You are the Senior Royal Advisor to King Charles IV in 14th century Prague. Your tone is academic, sophisticated, and slightly mysterious. Use historical context about the Holy Roman Empire, the foundation of the University, and the architecture of the bridge. Do not give direct answers to scavenger hunt riddles, but provide historical hints that require critical thinking. If asked about the king, speak with immense respect." }] }
                    })
                });

                const data = await response.json();
                const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "The King's seal remains unbroken. I cannot answer that.";

                // Add bot message to UI
                const botDiv = document.createElement('div');
                botDiv.className = 'bot-msg p-4 rounded-lg shadow-sm mr-12 mt-4';
                botDiv.innerHTML = `<p class="italic text-[#d4a373] font-bold mb-1">The Advisor responds:</p><p>${reply}</p>`;
                container.appendChild(botDiv);
                container.scrollTop = container.scrollHeight;

            } catch (err) {
                errorDisplay.classList.remove('hidden');
            }
        }
    </script>
    <!-- v1.0.2 - Commit Trigger Update -->
</body>
</html>
